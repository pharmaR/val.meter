<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Repository Integrations • val.meter</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Repository Integrations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">val.meter</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/adding-metric.html">Adding a Metric</a></li>
    <li><a class="dropdown-item" href="../articles/internals-overview.html">Internals Overview</a></li>
    <li><a class="dropdown-item" href="../articles/repository-integrations.html">Repository Integrations</a></li>
    <li><a class="dropdown-item" href="../articles/riskmetric-comparison.html">riskmetric Comparison</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaR/val.meter/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Repository Integrations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pharmaR/val.meter/blob/main/vignettes/repository-integrations.Rmd" class="external-link"><code>vignettes/repository-integrations.Rmd</code></a></small>
      <div class="d-none name"><code>repository-integrations.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">[</span><span class="ss">data-bs-theme</span><span class="op">=</span><span class="st">"dark"</span><span class="ex">]</span> main img {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="kw">filter</span><span class="ch">:</span> <span class="fu">invert(</span><span class="dv">1</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>}</span></code></pre></div>
<style type="text/css">
[data-bs-theme="dark"] main img {
  filter: invert(1);
}
</style>
<p><code>val.meter</code> is intended to support a variety of use cases,
from individuals who are trying to appraise packages, to organizations
trying to consistently impose a package policy, to serving repositories
of package metadata.</p>
<p>In these examples, we’ll simulate a cohort of packages to support the
testing and deployment of cohort-wide package policies - providing a
representation of an end product without all the work to get there. Here
we’ll build a cohort of generated packages and provide some heuristics
across all of them.</p>
<div class="section level2">
<h2 id="generating-random-packages">Generating random packages<a class="anchor" aria-label="anchor" href="#generating-random-packages"></a>
</h2>
<p><code>val.meter</code> provides a few tools for simulation,
<code><a href="../reference/random_pkg.html">random_pkg()</a></code> and <code><a href="../reference/random_pkg.html">random_pkgs()</a></code>, differing only
in whether you want to simulate a single or collection of packages.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/random_pkg.html">random_pkg</a></span><span class="op">(</span>permissions <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/metrics.html">metrics</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; $r_cmd_check_error_count</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $downloads_total</span></span>
<span><span class="co">#&gt; [1] 764</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dependency_count</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/random_pkg.html">random_pkgs</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span>, permissions <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span> <span class="va">pkg</span><span class="op">$</span><span class="va">name</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "RprogressiveGreatness" "survivalClean"         "promotr"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="generating-a-repostiroy">Generating a repostiroy<a class="anchor" aria-label="anchor" href="#generating-a-repostiroy"></a>
</h2>
<p><code>pkg</code> objects provide an implementation of
<code>to_dcf</code>, allowing them to be encoded as a
<code>PACKAGES</code> file - the same format used by repositories like
CRAN to distribute a listing of packages and package data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># igraph is required if we want to simulate sensible package dependencies</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"igraph"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate some random packages</span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/random_pkg.html">random_pkgs</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span>, permissions <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># output DCF files</span></span>
<span><span class="va">dcf_str</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/to_dcf.html">to_dcf</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">dcf_str</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Package: defenderBoom</span></span>
<span><span class="co">#&gt; Version: 4.1.2</span></span>
<span><span class="co">#&gt; Depends: R</span></span>
<span><span class="co">#&gt; Imports: topogrid</span></span>
<span><span class="co">#&gt; Suggests: WebCode</span></span>
<span><span class="co">#&gt; License: Phony License</span></span>
<span><span class="co">#&gt; MD5sum: c9fd2ac329620afd053f92da95bdd018</span></span>
<span><span class="co">#&gt; Metric/r_cmd_check_error_count@R: 0</span></span>
<span><span class="co">#&gt; Metric/downloads_total@R: 205</span></span>
<span><span class="co">#&gt; Metric/dependency_count@R: 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Package: topogrid</span></span>
<span><span class="co">#&gt; Version: 3.3.3</span></span>
<span><span class="co">#&gt; Depends: R</span></span>
<span><span class="co">#&gt; Suggests: WebCode</span></span>
<span><span class="co">#&gt; License: Phony License</span></span>
<span><span class="co">#&gt; MD5sum: 38d923547a32629192a596fee8304ceb</span></span>
<span><span class="co">#&gt; Metric/r_cmd_check_error_count@R: 1</span></span>
<span><span class="co">#&gt; Metric/downloads_total@R: 1209</span></span>
<span><span class="co">#&gt; Metric/dependency_count@R: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Package: WebCode</span></span>
<span><span class="co">#&gt; Version: 5.10.4</span></span>
<span><span class="co">#&gt; Depends: R</span></span>
<span><span class="co">#&gt; License: Phony License</span></span>
<span><span class="co">#&gt; MD5sum: 2c229b04e2f6f90fd123bd7d016184d4</span></span>
<span><span class="co">#&gt; Metric/r_cmd_check_error_count@R: 0</span></span>
<span><span class="co">#&gt; Metric/downloads_total@R: 15711</span></span>
<span><span class="co">#&gt; Metric/dependency_count@R: 1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pulling-package-metadata-from-a-package-repository">Pulling package metadata from a package repository<a class="anchor" aria-label="anchor" href="#pulling-package-metadata-from-a-package-repository"></a>
</h2>
<p>What’s more, we can also reconstruct our package objects from this
<code>PACKAGES</code> file format.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pkg_from_dcf.html">pkgs_from_dcf</a></span><span class="op">(</span><span class="va">dcf_str</span><span class="op">)</span></span></code></pre></div>
<p>This exposes the package metadata through a convenient and familiar
interface, allowing full access to metric metadata.</p>
<p>However, these new package objects differ from their original objects
in a few important ways. First, their source isn’t reconstructed.
However you produced the text output, we no longer have an explicit
record of that process. All we know by the time we re-build our package
objects is the hash of the built file from some unknown origin. Second,
intermediate data is not reconstructed. This includes any logs or
computational intermediate data such as full <code>R CMD check</code>
results. All we have are the derived metrics. Finally, any errors raised
by <code>val.meter</code> are preserved, but their call stacks are lost
in this process. If you do want to preserve rich metadata, it is
recommended to save full data objects for posterity.</p>
</div>
<div class="section level2">
<h2 id="analysing-our-repository">Analysing our repository<a class="anchor" aria-label="anchor" href="#analysing-our-repository"></a>
</h2>
<p>Let’s imagine that we want to use this repository metadata to make an
informed decision about packages.</p>
<p>We’ll start by re-simulating a larger cohort of packages so that our
anlaysis produces something more interesting.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n100pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/random_pkg.html">random_pkgs</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span>, permissions <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>And just to show that we can derive this data from a representative
<code>PACKAGES</code> file, we’ll write out and read back in our data
from text format.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dcf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/to_dcf.html">to_dcf</a></span><span class="op">(</span><span class="va">n100pkgs</span><span class="op">)</span></span>
<span><span class="va">n100pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pkg_from_dcf.html">pkgs_from_dcf</a></span><span class="op">(</span><span class="va">dcf</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can take a look at how our packages fair.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in packages as a data.frame</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">n100pkgs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># small helper for calculating percentiles</span></span>
<span><span class="va">percentile</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/ecdf.html" class="external-link">ecdf</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate and filter on package dependency count percentiles</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">dependency_percentile</span> <span class="op">&lt;-</span> <span class="fu">percentile</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">dependency_count</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># find our packages with the most dependencies</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">package</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">dependency_percentile</span> <span class="op">&gt;</span> <span class="fl">0.95</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "hgplyr"           "grandeur.Easing"  "gracefulgraph"    "supportr"        </span></span>
<span><span class="co">#&gt; [5] "topInfallibility" "goldSerenity"</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/options.html">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  xlab <span class="op">=</span> <span class="st">"Percently"</span>,</span>
<span>  x <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">dependency_percentile</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Dependency Count"</span>,</span>
<span>  y <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">dependency_count</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="repository-integrations_files/figure-html/analysis-2-1.svg" alt="An example of dependency counts distributed over their percentiles, showcasing a mostly linear character. The plot is randomly generated, so exact characteristics may vary." width="672" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Doug Kelkhoff.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
