<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Package data derivation error handling — errors • val.meter</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Package data derivation error handling — errors"><meta name="description" content="Because we aim to capture errors that are raised when evaluating packages,
there is a fair bit of machinery to raise relevant errors when package
assertions fail and capture errors during data execution."><meta property="og:description" content="Because we aim to capture errors that are raised when evaluating packages,
there is a fair bit of machinery to raise relevant errors when package
assertions fail and capture errors during data execution."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">val.meter</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/adding-metric.html">Adding a Metric</a></li>
    <li><a class="dropdown-item" href="../articles/internals-overview.html">Internals Overview</a></li>
    <li><a class="dropdown-item" href="../articles/repository-integrations.html">Repository Integrations</a></li>
    <li><a class="dropdown-item" href="../articles/riskmetric-comparison.html">riskmetric Comparison</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pharmaR/val.meter/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Package data derivation error handling</h1>
      <small class="dont-index">Source: <a href="https://github.com/pharmaR/val.meter/blob/main/R/utils_err.R" class="external-link"><code>R/utils_err.R</code></a></small>
      <div class="d-none name"><code>errors.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Because we aim to capture errors that are raised when evaluating packages,
there is a fair bit of machinery to raise relevant errors when package
assertions fail and capture errors during data execution.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="va">.state</span></span>
<span></span>
<span><span class="fu">once_on_task_callback</span><span class="op">(</span><span class="va">name</span>, <span class="va">expr</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_package_boundary_call</span><span class="op">(</span>calls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">sys.calls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cnd_type</span><span class="op">(</span>class <span class="op">=</span> <span class="cn">NULL</span>, cnd <span class="op">=</span> <span class="st">"error"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cnd_class_from_type</span><span class="op">(</span><span class="va">type</span>, cnd <span class="op">=</span> <span class="st">"error"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">new_err</span><span class="op">(</span></span>
<span>  <span class="va">...</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  class <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  call <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  trace <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parent <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  capture <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  .envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">err</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="format">Format<a class="anchor" aria-label="anchor" href="#format"></a></h2>
    <p>An object of class <code>environment</code> of length 2.</p>
<p>An object of class <code>list</code> of length 6.</p>
    </div>
    <div class="section level2">
    <h2 id="functions">Functions<a class="anchor" aria-label="anchor" href="#functions"></a></h2>

<ul><li><p><code>.state</code>: Global error raising flags</p>
<p>This flag is used to determine when errors during execution should be
captured or thrown to the evaluating environment. When data is being
derived for the first time, we want to capture any errors, but when errors
arrive during other uses of that data, we want to raise them to the user.</p></li>
<li><p><code>once_on_task_callback()</code>: Used to reset global state after a top level callback completes</p></li>
<li><p><code>get_package_boundary_call()</code>: Walk the call stack to find the last call before the package boundary. This
allows us to raise the most relevant parts of error messages back to users
without exposing them to the internal non-standard evaluation calls.</p></li>
<li><p><code>cnd_type()</code>: Create a condition type</p></li>
<li><p><code>cnd_class_from_type()</code>: Extract a condition class from a type</p></li>
<li><p><code>new_err()</code>: Create a new error</p>
<p>This function is a wrapper around <code><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli::cli_abort()</a></code>, but with defaults
that make typical use within this package more interpretable to end-users.</p>
<p>Used predominately by <code>err()</code></p></li>
<li><p><code>err</code>: Raise a new error, using one of a set of known error types</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="fields">Fields<a class="anchor" aria-label="anchor" href="#fields"></a></h2>


<dl><dt><code>disallowed_permissions</code></dt>
<dd><p>Create an error indicating that a data
derivation requires permissions that were not permitted at execution
time.</p></dd>


<dt><code>missing_suggests</code></dt>
<dd><p>Create an error indicating that a dependency that
is required for a specific data derivation is not available.</p></dd>


<dt><code>metric_not_atomic</code></dt>
<dd><p>Create an error indicating that a metric was
derived but did not conform to its anticipated atomic return type.</p></dd>


<dt><code>derive_dependency</code></dt>
<dd><p>Create an error that is raised when a dependent
data field threw an error during execution.</p></dd>


<dt><code>data_not_implemented</code></dt>
<dd><p>Create an error indicating that data could not
be derived because it is not implemented for this resource.</p></dd>


<dt><code>derive_error</code></dt>
<dd><p>Wrap an error raised through data derivation in a
packag error type for communication.</p></dd>


</dl></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Doug Kelkhoff.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

